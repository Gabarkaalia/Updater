# Find the essential package
find_package (
	LATEX
	COMPONENTS
		PDFLATEX
		BIBTEX
)

# Set and create a directory for dumping output files to
set (
	OUTPUT_DIR
		output
)

if (NOT EXISTS ${OUTPUT_DIR})

	file (
		MAKE_DIRECTORY
			${OUTPUT_DIR}
	)

endif ()


# Set a name for the main file; this should actually be the same as the main input tex file
set (
	SOURCE_FILE
		main
)

# Simply do a pdflatex pass, followed by a bibtex pass, followed by two more pdflatex passes
add_custom_target (
	main
	ALL
	COMMAND
		${PDFLATEX_COMPILER} --output-directory ${OUTPUT_DIR} ${SOURCE_FILE}.tex
	COMMAND
		${BIBTEX_COMPILER} "${OUTPUT_DIR}/${SOURCE_FILE}.aux"
	COMMAND
		${PDFLATEX_COMPILER} --output-directory ${OUTPUT_DIR} ${SOURCE_FILE}.tex
	COMMAND
		${PDFLATEX_COMPILER} --output-directory ${OUTPUT_DIR} ${SOURCE_FILE}.tex
	WORKING_DIRECTORY
		${CMAKE_SOURCE_DIR}/src
	COMMENT
		"Executing the pdflatex and bibtex compilation passes..."
)

# Cleanup just involves deleting the output directory and placing the pdf into the bin directory
add_custom_target (
	cleanup
	ALL
	DEPENDS
		main
	COMMAND
		${CMAKE_COMMAND} -E remove_directory ${OUTPUT_DIR}
	COMMAND
		${CMAKE_COMMAND} -E copy ${SOURCE_FILE}.pdf ${CMAKE_BINARY_DIR}
	COMMAND
		${CMAKE_COMMAND} -E remove -f ${SOURCE_FILE}.pdf
	WORKING_DIRECTORY
		${CMAKE_SOURCE_DIR}/src
	COMMENT
		"Cleaning up and packaging the pdf into the output directory..."
)